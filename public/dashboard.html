<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Família Soprano - Painel</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="stylesheet" href="./css/style_logado.css">
    <link rel="shortcut icon" href="./assets/icon.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <div class="img_logo">
            <img src="./Assets/logo_sopranos.png" alt="" onclick="voltar()">
        </div>
        <ul class="navbar">
            <li><a href="index_logado.html">Home</a></li>
            <li><a href="./personagens_logado.html">Personagens</a></li>
            <li><a href="./premiacoes_logado.html">Premiações</a></li>
            <li><a href="./jogo_memoria.html">Jogo da memória</a></li>
            <li><a href="" style=" color:#f90201;">Painel</a></li>
        </ul>
        <div class="perfil">
            <img src="./Assets/foto_perfil.png" alt="" onclick="mudar_estado_perfil()">
        </div>
    </div>
    <div class="area_perfil" id="perfil">
        <div class="perfil_sup">
            <span id="b_nome">Olá  NomeUsuário!</span>
            <img src="./Assets/x.png"  id="fechar" onclick="mudar_estado_perfil()">
        </div>
        <div class="txt_perfil">
            <span id="b_email">emailUsuario@.com</span>
        </div>
        <span onclick="voltar_deslogado()">Sair da conta</span>
    </div>

    <div class="container_dashboard">
        <img src="./Assets/christopher_dashboard.jpg" alt="">
        <div class="conteudo">
            <div class="rankings">
                <div class="ranking_normal">
                    <table class="tabela_normal">
                        <colgroup>
                            <col/>
                            <col/>
                        </colgroup>
                        <tr>
                            <th>TESTE_NOME</th>
                            <th>TESTE_TEMPO</th>
                        </tr>
                        <tr>
                            <td>TESTE2_NOME</td>
                            <td>TESTE2_TEMPO</td>
                        </tr>
                    </table>
                </div>
    
                <div class="ranking_dificil">
                    <table class="tabela_dificil">
                        <tr>
                            <th>TESTE_NOME</th>
                            <th>TESTE_TEMPO</th>
                        </tr>
                        <tr>
                            <td>TESTE2_NOME</td>
                            <td>TESTE2_TEMPO</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="dashboard">
                <canvas id="myChart2"></canvas>
            </div>
        </div>
        <button onclick="puxarDados()">TENTAR</button>
    </div>
</body>
</html>



<script>
    b_nome.innerHTML = `Olá ${sessionStorage.NOME_USUARIO}`;
    b_email.innerHTML = `Email: ${sessionStorage.EMAIL_USUARIO}`;

    function voltar() {
        document.location.href = './index_logado.html'
    }

    function mudar_estado_perfil() {
        var display = document.getElementById('perfil').style.display;

        if(display == 'none' || display == '') {
            document.getElementById('perfil').style.display = 'flex'
        } else {
            document.getElementById('perfil').style.display = 'none'
        }
    }

    function fechar_perfil() {
        document.getElementById('perfil').style.display = 'none';
    }

    function voltar_deslogado() {
        resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
            sessionStorage.EMAIL_USUARIO = '';
            sessionStorage.NOME_USUARIO = '';
            sessionStorage.ID_USUARIO = '';


            setTimeout(function () {
                window.location = "./index.html";
            }, 3000); // apenas para exibir o loading
        })
    }
</script>

<script>

    window.onload = () => {
        criarGraficos();
    }

    function puxarDados() {
        fetch("/jogo/buscar", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            },
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                    sessionStorage.USUARIOS_GRAFICO = json.resultadoMediaTempo.nome
                    sessionStorage.MEDIAS_GRAFICOS = json.resultadoMediaTempo.media
                    sessionStorage.USUARIOS_NORMAL = json.resultadoRankingNormal.nome;
                    sessionStorage.TEMPOS_NORMAL = json.resultadoRankingNormal.tempo;
                    sessionStorage.USUARIOS_DIFICIL = json.resultadoRankingDificil.nome;
                    sessionStorage.TEMPOS_DIFICIL = json.resultadoRankingDificil.tempo;
                });

            } else {
                console.log("Houve um erro ao puxar os dados!");

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    const criarGraficos = () => {
        const ctx = document.getElementById('myChart2');
      
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
              label: 'Usuário logado',
              data: [12, 19, 3, 5, 2, 3],
              borderWidth: 1,
              backgroundColor:'rgb(249, 2, 1)'
            }]
          },
          
          options: {
            plugins: {
                legend: {
                    labels: {
                        color: '#ffffff'
                    } 
                },
                title: {
                    display: true,
                    text: 'Média de tempo por usuário',
                    color: '#f99601',
                    font: {
                        size: 30,
                        family: "'Fjalla One', sans-serif"
                    }
                }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid : {
                    color: 'rgb(77, 13, 13, 0.8)'
                },

                ticks: {
                    color: '#ffffff'
                }
              },

              x: {
                ticks: {
                    color: '#ffffff'
                }
              }
            }
          }
        });
    }

  </script>
  