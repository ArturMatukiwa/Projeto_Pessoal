<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Família Soprano</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/jogo_memoria.css">
    <link rel="stylesheet" href="./css/style_logado.css">
    <link rel="shortcut icon" href="./assets/icon.png">
</head>
<body>
    <div class="header">
        <div class="img_logo">
            <img src="./Assets/logo_sopranos.png"  onclick="voltar()">
        </div>
        <ul class="navbar">
            <div class="nav1 nav">
                <li><a href="./index_logado.html" >Home</a></li>
                <li><a href="./personagens_logado.html">Personagens</a></li>
                <li><a href="./premiacoes_logado.html">Premiações</a></li>
                <li><a href="" style=" color:#f90201;">Jogo da memória</a></li>
                <li><a href="./dashboard.html">Painel</a></li>
            </div>
            <div class="perfil" onclick="mudar_estado_perfil()">
                <img src="./Assets/foto_perfil.png" >
            </div>
        </ul>
    </div>
    <div class="area_perfil" id="perfil">
        <div class="perfil_sup">
            <span id="b_nome">Olá  NomeUsuário!</span>
            <img src="./Assets/x.png"  id="fechar" onclick="mudar_estado_perfil()">
        </div>
        <div class="txt_perfil">
            <span id="b_email">emailUsuario@.com</span>
        </div>
        <span onclick="voltar_deslogado()">Sair da conta</span>
    </div>

    <div class="container">
        <div class="conteudo">
            <div class="area_jogo" id="area_jogo">
                <h2>Clique para jogar</h2>
                <button onclick="jogar()">Jogar</button>
            </div>
            <div class="card_jogo" id="card_jogo">
                <div class="jogo_sup">
                    <h2>Jogo da memória</h2>
                    <img src="./assets/seta-voltar.png" onclick="voltar()">
                </div>
                <div class="jogo" id="jogo">
                    <!-- <div class="card">
                        <div class="face frente"></div>
                        <div class="face costas"></div>
                    </div> -->
                </div>
            </div>
        </div>
    </div>
</body>

<script>

    
    const jogo = document.querySelector('.jogo');
    
    const characters = [
        'carta_adriana',
        'carta_aj',
        'carta_carmela',
        'carta_christopher',
        'carta_dramelfi',
        'carta_junior',
        'carta_livia',
        'carta_meadow',
        'carta_paulie',
        'carta_tony',
    ];

    const createElement = (tag, className) => {
        const element = document.createElement(tag);
        element.className = className;
        return element;
    }

    let firstCard = '';
    let secondCard = '';

    const checkEndGame = () => {
        const disabledCards = document.querySelectorAll('.disabled_card');

        if(disabledCards.length == 20) {
            alert('Parabéns, você conseguiu!');
        }
    }

    const checkCards = () => {
        const firstCharacter = firstCard.getAttribute('data-character');
        const secondCharacter = secondCard.getAttribute('data-character');
        if(firstCharacter === secondCharacter) {
            
            firstCard.firstChild.classList.add('disabled_card');
            secondCard.firstChild.classList.add('disabled_card');
            
            firstCard = '';
            secondCard = '';
            setTimeout(() => {
                checkEndGame();
            }, 500)
        } else {
            setTimeout(() => {
                firstCard.classList.remove('reveal_card');
                secondCard.classList.remove('reveal_card');

                firstCard = '';
                secondCard = '';
            }, 700)

        }
    }

    const revealCard = ({ target }) => {

        if(target.parentNode.className.includes('reveal_card')) {
            return;
        }

        if(firstCard === '') {
            target.parentNode.classList.add('reveal_card');
            firstCard = target.parentNode;
        } else if(secondCard === '') {
            target.parentNode.classList.add('reveal_card');
            secondCard = target.parentNode;

            checkCards();
        }

    }

    const createCard = (character) => {
        const card = createElement('div', 'card'); 
        const frente = createElement('div', 'face frente'); 
        const costas = createElement('div', 'face costas');

        frente.style.backgroundImage = `url('./assets/cartas_jogo/${character}.png')`;

        card.appendChild(frente);
        card.appendChild(costas);

        card.addEventListener('click', revealCard);
        card.setAttribute('data-character', character)

        return card;
    }
    

    const loadGame = () => {

        const duplicateCharacters = [ ...characters, ...characters];

        const shuffledArray = duplicateCharacters.sort( () => Math.random() - 0.5);


        shuffledArray.forEach((character) =>{

            const card = createCard(character);
            jogo.appendChild(card);

        });
    }

    loadGame();

    b_nome.innerHTML = `Olá ${sessionStorage.NOME_USUARIO}`;
    b_email.innerHTML = `Email: ${sessionStorage.EMAIL_USUARIO}`;

    function voltar() {
        document.location.href = './index_logado.html'
    }

    function mudar_estado_perfil() {
        var display = document.getElementById('perfil').style.display;

        if(display == 'none' || display == '') {
            document.getElementById('perfil').style.display = 'flex'
        } else {
            document.getElementById('perfil').style.display = 'none'
        }
    }

    function voltar_deslogado() {
        // resposta.json().then(json => {
        //             console.log(json);
        //             console.log(JSON.stringify(json));
            sessionStorage.EMAIL_USUARIO = '';
            sessionStorage.NOME_USUARIO = '';
            sessionStorage.ID_USUARIO = '';


            setTimeout(function () {
                window.location = "./index.html";
            }, 3000); // apenas para exibir o loading
        // })
    }

    function jogar() {
        area_jogo.style.display = 'none';
        card_jogo.style.display = 'flex'
    }
    
    function voltar() {
        card_jogo.style.display = 'none';
        area_jogo.style.display = 'flex';
    }
</script>